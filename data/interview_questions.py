"""
초안 생성기 인터뷰 질문 세트
대한항공 자소서 3문항에 맞는 날카로운 질문 설계
설계서: FLYREADY_초안생성기_설계서.md 기반
"""

# ═══════════════════════════════════════════════
# 1번 문항: 지원동기 + 직무적합성
# ═══════════════════════════════════════════════

Q1_QUESTIONS = [
    {
        "id": "q1_1",
        "question": "대한항공 승무원, 왜요? 다른 항공사도 많은데 왜 꼭 대한항공이에요?",
        "intent": "대한항공 특정 이유 끌어내기",
        "warning_triggers": ["어릴 때부터", "꿈", "유니폼"],
        "warning_response": "그건 지원동기가 아니라 꿈 이야기예요. 대한항공이어야 하는 '지금의 이유'가 뭐예요?",
        "followup": "대한항공 비행기를 직접 탄 적 있어요? 그때 뭘 느꼈어요?"
    },
    {
        "id": "q1_2",
        "question": "서비스 관련 경험 중 가장 기억에 남는 거 하나만요. 알바, 봉사, 동아리 뭐든 상관없어요.",
        "intent": "핵심 서비스 경험 1개 확보",
        "followup": "그 상황에서 정확히 뭘 했어요? '잘 대했다' 말고, 구체적 행동이요."
    },
    {
        "id": "q1_3",
        "question": "그때 상대방(고객/동료)의 반응은 어땠어요? 표정이나 말, 기억나는 거 있어요?",
        "intent": "감성적 디테일 확보 (피크엔드용)"
    },
    {
        "id": "q1_4",
        "question": "혹시 그 경험에서 숫자로 말할 수 있는 게 있어요? 사람 수, 기간, 횟수, 만족도 점수 같은 거요.",
        "intent": "숫자 데이터 직접 확보",
        "followup": "대략이라도요. 한 달에 몇 명 정도 응대했어요?"
    },
    {
        "id": "q1_5",
        "question": "그 경험이 승무원 일이랑 어떻게 연결된다고 생각해요? 억지로 끼워맞추지 말고 솔직하게요.",
        "intent": "직무 연결 소재 확보",
        "challenge": "그거 서비스직이면 다 해당되는 거 아닌가요? '승무원'이어야 하는 이유는 뭐예요?"
    },
    {
        "id": "q1_6",
        "question": "대한항공이 지금 아시아나 통합 중인 거 알고 있죠? 이 시기에 입사하면 뭐가 달라질 거라고 생각해요?",
        "intent": "통합 이슈 소재 확보 + 기업 이해도 확인",
        "followup": "메가 캐리어로 가는 과정에서 승무원에게 어떤 역량이 더 필요해질까요?"
    },
    {
        "id": "q1_7",
        "question": "입사 후 3년 뒤에 어떤 승무원이 되고 싶어요? '최고의 승무원' 같은 추상적인 거 말고, 구체적으로요.",
        "intent": "포부 소재 확보",
        "challenge": "그건 목표가 아니라 바람이에요. 뭘 하겠다는 건지 행동으로 말해주세요."
    }
]


# ═══════════════════════════════════════════════
# 2번 문항: 역량 (안전 + 서비스)
# ═══════════════════════════════════════════════

Q2_QUESTIONS = [
    {
        "id": "q2_1",
        "question": "승무원한테 가장 중요한 역량이 뭐라고 생각해요? 한 가지만요. 두 개 말하면 안 돼요.",
        "intent": "핵심 역량 1개 확정",
        "warning_triggers": ["책임감", "성실"],
        "warning_response": "그건 누구나 말하는 거예요. 왜 그 역량이 승무원에게 '특히' 중요한가요?",
        "common_answers": {
            "소통": "소통이 왜 '안전'에도 중요한데요? 구체적으로요.",
            "공감": "공감이 비상 상황에서 어떻게 작동해요?",
            "체력": "체력은 역량이 아니라 조건이에요. 다시 생각해보세요."
        }
    },
    {
        "id": "q2_2",
        "question": "그 역량이 '안전' 측면에서 왜 중요해요? 기내 비상 상황을 상상하면서 말해보세요.",
        "intent": "안전 파트 소재 확보",
        "followup": "브리핑, 비상탈출, 터뷸런스 상황 중 그 역량이 가장 필요한 건 언제예요?"
    },
    {
        "id": "q2_3",
        "question": "그러면 '서비스' 측면에서는요? 기내에서 승객을 응대하는 장면으로 말해주세요.",
        "intent": "서비스 파트 소재 확보"
    },
    {
        "id": "q2_4",
        "question": "그 역량을 실제로 발휘한 경험이 있어요? 안전이든 서비스든, 비슷한 상황에서 쓴 적 있는 거요.",
        "intent": "실제 경험 소재 확보",
        "challenge": "그건 그 역량을 쓴 건가요, 아니면 그냥 그 상황에 있었던 건가요?"
    },
    {
        "id": "q2_5",
        "question": "그 경험에서 구체적으로 어떤 행동을 했어요? '소통했다' 말고, 정확히 뭘 했는지요.",
        "intent": "행동 동사 확보",
        "followup": "말로 했어요? 행동으로? 뭔가 만들었어요? 제안했어요?"
    },
    {
        "id": "q2_6",
        "question": "숫자로 표현할 수 있는 부분이 있을까요? 사람 수, 시간, 횟수, 결과 변화 같은 거요.",
        "intent": "숫자 확보"
    },
    {
        "id": "q2_7",
        "question": "안전이랑 서비스, 둘 중 뭐가 더 중요하다고 생각해요? 비중으로 말하면 몇 대 몇?",
        "intent": "균형 감각 확인 + 안전/서비스 비중 조절 힌트",
        "warning_check": lambda ratio: ratio.split(":")[0] if ":" in ratio else "5",
        "warning_response": "면접관은 둘 다 중요하다고 봐요. 4:6에서 6:4 정도가 좋거든요. 약한 쪽 경험을 하나 더 생각해볼까요?"
    }
]


# ═══════════════════════════════════════════════
# 3번 문항: 부담스러운 과제 극복
# ═══════════════════════════════════════════════

Q3_QUESTIONS = [
    {
        "id": "q3_1",
        "question": "살면서 하기 싫었는데 해야 했던 일이 있어요? 크든 작든 상관없어요. 진짜 부담스러웠던 거요.",
        "intent": "소재 확보",
        "warning_triggers": ["가족", "건강", "죽음"],
        "warning_response": "그건 자소서에 쓰기엔 좀 무거워요. 직장/학교/동아리에서 겪은 거 없어요?",
        "challenge": "그건 좀 가벼운데요. 진짜 '이걸 해야 하나?' 고민했던 수준의 거 없어요?"
    },
    {
        "id": "q3_2",
        "question": "그걸 맡게 된 상황을 자세히 말해주세요. 누가 시켰어요? 왜 당신이었어요?",
        "intent": "상황 설정 소재"
    },
    {
        "id": "q3_3",
        "question": "솔직히 처음 느낌이 어땠어요? '해야지'가 아니라 진짜 첫 반응이요. 싫었어요? 무서웠어요? 자신 없었어요?",
        "intent": "부담 인정 소재 (3번의 핵심)",
        "challenge": "바로 '해보자'고 생각했다구요? 그러면 부담이 아니잖아요. 진짜 싫었던 부분이 뭐예요?"
    },
    {
        "id": "q3_4",
        "question": "그래도 하기로 한 이유는 뭐예요? 의무감? 책임감? 아니면 다른 이유?",
        "intent": "판단 기준 소재",
        "followup": "다른 사람이었으면 거절했을 수도 있는 건데, 왜 당신은 받아들였어요?"
    },
    {
        "id": "q3_5",
        "question": "막상 시작하니까 뭐가 어려웠어요? 예상했던 어려움? 예상 못 한 어려움?",
        "intent": "노력 과정 소재"
    },
    {
        "id": "q3_6",
        "question": "그 어려움을 어떻게 해결했어요? 구체적 행동이요. '열심히 했다' 말고.",
        "intent": "행동 동사 + 구체적 방법 확보",
        "followup": "혹시 뭔가 새로 만들었어요? 방법을 바꿨어요? 누군가한테 물어봤어요? 분석했어요?"
    },
    {
        "id": "q3_7",
        "question": "결과가 어떻게 됐어요? 숫자로 말할 수 있는 거 있어요?",
        "intent": "결과 + 숫자 확보",
        "followup": "주변 반응은요? 다시 부탁받았어요? 태도가 달라졌어요?"
    },
    {
        "id": "q3_8",
        "question": "이 경험 이후에 달라진 게 있어요? 비슷한 상황이 또 왔을 때 다르게 행동했다든가.",
        "intent": "성장/변화 소재 (마무리용)"
    },
    {
        "id": "q3_9",
        "question": "이 경험이 승무원 일이랑 연결된다면 어떤 상황일까요?",
        "intent": "직무 연결 소재",
        "followup": "승무원도 비선호 업무가 있거든요. 새벽 비행, 기내 청소, 까다로운 승객 응대... 그때 이 경험이 어떻게 도움이 될까요?"
    }
]


# ═══════════════════════════════════════════════
# 통합 질문 세트
# ═══════════════════════════════════════════════

QUESTION_SETS = {
    1: Q1_QUESTIONS,
    2: Q2_QUESTIONS,
    3: Q3_QUESTIONS
}


def get_questions(question_num: int) -> list:
    """문항 번호에 해당하는 질문 세트 반환"""
    return QUESTION_SETS.get(question_num, [])


def get_question_count(question_num: int) -> int:
    """문항별 질문 개수 반환"""
    return len(QUESTION_SETS.get(question_num, []))


# ═══════════════════════════════════════════════
# 인터뷰어 시스템 프롬프트 (할루시네이션 제로)
# ═══════════════════════════════════════════════

INTERVIEWER_SYSTEM_PROMPT = """당신은 대한항공 객실승무원 자소서 작성을 돕는 인터뷰어입니다.

[절대 원칙 - 할루시네이션 제로]
1. 사용자가 말한 내용만 기록합니다. 절대로 경험을 추측하거나 창작하지 않습니다.
2. 모호한 답변에는 "구체적으로요"라고 추가 질문합니다.
3. 없는 숫자를 만들지 않습니다. "대략 몇 명?" 식으로 사용자에게 직접 묻습니다.
4. 거짓말, 과장, 추측, 창작 절대 금지.

[역할]
- 사용자의 경험을 끌어내는 날카로운 질문을 합니다
- 한 번에 질문 1개만 합니다
- 모호한 답변에는 반드시 후속 질문으로 파고듭니다
- 칭찬은 최소화하고 구체적인 내용을 요구합니다

[규칙]
1. 답변이 모호하면: "구체적으로요. 정확히 뭘 했어요?" 추가 질문
2. 답변이 짧으면: "더 있을 것 같은데요. 그때 상황을 더 말해주세요"
3. "잘 모르겠어요": "비슷한 거라도요. 완벽 안 해도 돼요"
4. 탈락 소재가 나오면: 부드럽게 방향 전환
   예: "어릴 때부터 꿈" → "그건 좋은데, '지금' 대한항공인 이유가 더 중요해요"
5. 충분한 답변이 나오면: 다음 질문으로 자연스럽게 넘어가기

[톤]
- 친근하지만 전문적
- "~요" 체 사용
- 가끔 반박해서 더 깊은 답변 유도

[금지]
- 사용자 경험 창작/각색
- 추측성 정보 제공
- "아마~", "~일 것 같아요" 등 추측 표현
- 숫자 임의 생성"""


def get_interviewer_prompt(question_num: int, current_q: int, answers: dict) -> str:
    """현재 상태에 맞는 인터뷰어 프롬프트 생성"""
    import json
    questions = get_questions(question_num)
    total = len(questions)

    return f"""{INTERVIEWER_SYSTEM_PROMPT}

[현재 진행]
- {question_num}번 문항 인터뷰 중
- 현재 질문: {current_q + 1}/{total}번째
- 이전 답변들: {json.dumps(answers, ensure_ascii=False)}

다음 질문: "{questions[current_q]['question'] if current_q < total else '완료'}"
질문 의도: {questions[current_q].get('intent', '') if current_q < total else ''}"""
