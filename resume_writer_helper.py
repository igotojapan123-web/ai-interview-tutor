# resume_writer_helper.py
# ìì†Œì„œ ì‘ì„± ë„ìš°ë¯¸ - ë¬¸í•­ ì˜ë„ ë¶„ì„ ë° ì±—ë´‡ ì§€ì› ëª¨ë“ˆ

import os
import json
from typing import Dict, List, Optional
from datetime import datetime

# ì„¤ì • import
try:
    from config import AIRLINE_DATA, AIRLINE_VALUES, AIRLINES
    CONFIG_AVAILABLE = True
except ImportError:
    CONFIG_AVAILABLE = False
    AIRLINE_DATA = {}
    AIRLINE_VALUES = {}
    AIRLINES = []

# ìƒì„¸ í•­ê³µì‚¬ ë°ì´í„°ë² ì´ìŠ¤ import
try:
    from airline_database import (
        AIRLINE_FULL_DATA,
        get_airline_for_prompt,
        AIRLINE_KEYWORDS_SUMMARY,
        AIRLINE_DIFFERENTIATION
    )
    AIRLINE_DB_AVAILABLE = True
except ImportError:
    AIRLINE_DB_AVAILABLE = False
    AIRLINE_FULL_DATA = {}
    AIRLINE_KEYWORDS_SUMMARY = {}
    AIRLINE_DIFFERENTIATION = {}
    def get_airline_for_prompt(airline): return ""

# ë‰´ìŠ¤ ìŠ¤í¬ë˜í¼ import
try:
    from news_scraper import get_airline_news, get_news_summary
    NEWS_AVAILABLE = True
except ImportError:
    NEWS_AVAILABLE = False

# OpenAI í´ë¼ì´ì–¸íŠ¸
try:
    from openai import OpenAI
    OPENAI_AVAILABLE = True
except ImportError:
    OPENAI_AVAILABLE = False


def get_openai_client():
    """OpenAI í´ë¼ì´ì–¸íŠ¸ ë°˜í™˜"""
    if not OPENAI_AVAILABLE:
        return None
    try:
        return OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
    except:
        return None


# ============================================
# ë¬¸í•­ ì˜ë„ ë¶„ì„
# ============================================

ANALYSIS_SYSTEM_PROMPT = """ë‹¹ì‹ ì€ 10ë…„ì°¨ í•­ê³µì‚¬ ì¸ì‚¬íŒ€ ì¶œì‹  ìì†Œì„œ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.
ìì†Œì„œ ë¬¸í•­ì˜ ìˆ¨ì€ ì˜ë„ë¥¼ ì •í™•íˆ íŒŒì•…í•˜ê³ , ë©´ì ‘ê´€ ê´€ì ì—ì„œ ë¶„ì„í•©ë‹ˆë‹¤.

## ì—­í• 
- ìì†Œì„œ ë¬¸í•­ì˜ ìˆ¨ì€ ì˜ë„ë¥¼ ì •í™•íˆ íŒŒì•…
- ë©´ì ‘ê´€ ê´€ì ì—ì„œ "ì´ ì§ˆë¬¸ìœ¼ë¡œ ë­˜ ë³´ë ¤ëŠ”ì§€" ë¶„ì„
- í•´ë‹¹ í•­ê³µì‚¬ì˜ ì¸ì¬ìƒê³¼ ìµœê·¼ ë™í–¥ ë°˜ì˜
- êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ê°€ì´ë“œë¼ì¸ ì œê³µ

## ë¶„ì„ ì›ì¹™
1. ë¬¸í•­ì˜ í‘œë©´ì  ì˜ë¯¸ vs ì‹¤ì œ ì˜ë„ êµ¬ë¶„
2. í•­ê³µì‚¬ë³„ ì°¨ë³„í™” í¬ì¸íŠ¸ ë°˜ì˜
3. ìµœê·¼ ë‰´ìŠ¤/ì´ìŠˆì™€ ì—°ê²° ê°€ëŠ¥í•œ ë¶€ë¶„ ì œì‹œ
4. ì¶”ìƒì  ì¡°ì–¸ì´ ì•„ë‹Œ êµ¬ì²´ì  ê°€ì´ë“œë¼ì¸

## ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ JSON)
{
    "intent": "ë©´ì ‘ê´€ì´ ì´ ì§ˆë¬¸ìœ¼ë¡œ ë³´ê³  ì‹¶ì€ ê²ƒ (1-2ë¬¸ì¥)",
    "hidden_meaning": "í‘œë©´ ì•„ë˜ ìˆ¨ì€ ì˜ë„ (1-2ë¬¸ì¥)",
    "airline_fit": "ì´ í•­ê³µì‚¬ê°€ íŠ¹ë³„íˆ ì›í•˜ëŠ” ë‹µë³€ ë°©í–¥ (2-3ê°€ì§€)",
    "news_context": "ìµœê·¼ ë‰´ìŠ¤/íŠ¸ë Œë“œì™€ ì—°ê²°í•  ìˆ˜ ìˆëŠ” í¬ì¸íŠ¸ (ì—†ìœ¼ë©´ null)",
    "guidelines": ["ê°€ì´ë“œë¼ì¸ 1", "ê°€ì´ë“œë¼ì¸ 2", "ê°€ì´ë“œë¼ì¸ 3"],
    "structure": "ê¶Œì¥ êµ¬ì¡° (ì˜ˆ: ì •ì˜ â†’ ê²½í—˜ â†’ ì ìš©)",
    "example_draft": "ì˜ˆì‹œ ì´ˆì•ˆ ì²« 2-3ë¬¸ì¥ (ë³¸ì¸ ê²½í—˜ìœ¼ë¡œ ëŒ€ì²´ í•„ìš” ëª…ì‹œ)",
    "keywords": ["ì¶”ì²œ í‚¤ì›Œë“œ 1", "ì¶”ì²œ í‚¤ì›Œë“œ 2"],
    "avoid": ["í”¼í•´ì•¼ í•  í‘œí˜„ 1", "í”¼í•´ì•¼ í•  í‘œí˜„ 2"]
}
"""


def analyze_question_intent(
    question: str,
    airline: str,
    recent_news: Optional[List[Dict]] = None
) -> Dict:
    """
    ìì†Œì„œ ë¬¸í•­ ì˜ë„ ë¶„ì„

    Args:
        question: ìì†Œì„œ ë¬¸í•­ (ì˜ˆ: "ì§€ì›ë™ê¸°ë¥¼ ì‘ì„±í•˜ì„¸ìš”")
        airline: í•­ê³µì‚¬ëª…
        recent_news: ìµœê·¼ ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)

    Returns:
        Dict: ë¶„ì„ ê²°ê³¼
    """
    client = get_openai_client()
    if not client:
        return _get_fallback_analysis(question, airline)

    # í•­ê³µì‚¬ ì •ë³´ ìˆ˜ì§‘ (ìƒì„¸ ë°ì´í„°ë² ì´ìŠ¤ ìš°ì„ )
    airline_info = AIRLINE_DATA.get(airline, {})
    airline_values = AIRLINE_VALUES.get(airline, [])

    # ìƒì„¸ í•­ê³µì‚¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    airline_full_info = ""
    if AIRLINE_DB_AVAILABLE:
        airline_full_info = get_airline_for_prompt(airline)

    # ë‰´ìŠ¤ ì •ë³´ (3ê°œì›”ì¹˜ ì „ì²´)
    if recent_news is None and NEWS_AVAILABLE:
        recent_news = get_airline_news(airline, days=90)

    news_text = ""
    if recent_news:
        news_text = "\n".join([
            f"- [{n.get('published_at', '')}] {n.get('title', '')}"
            for n in recent_news
        ])

    # ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ êµ¬ì„± (ìƒì„¸ ë°ì´í„° í¬í•¨)
    user_prompt = f"""## ë¶„ì„ ëŒ€ìƒ
- í•­ê³µì‚¬: {airline}
- ë¬¸í•­: "{question}"

{airline_full_info if airline_full_info else f'''## í•­ê³µì‚¬ ê¸°ë³¸ ì •ë³´
- ìœ í˜•: {airline_info.get('type', 'N/A')}
- ë¯¸ì…˜: {airline_info.get('mission', 'N/A')}
- í•µì‹¬ê°€ì¹˜: {', '.join(airline_info.get('core_values', []))}
- ì¸ì¬ìƒ: {', '.join(airline_info.get('talent', []))}
- ë©´ì ‘ í¬ì»¤ìŠ¤: {airline_info.get('interview_focus', 'N/A')}'''}

## ìµœê·¼ ë‰´ìŠ¤ (3ê°œì›”ê°„ {len(recent_news) if recent_news else 0}ê±´)
{news_text if news_text else "ë‰´ìŠ¤ ì •ë³´ ì—†ìŒ"}

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì´ ë¬¸í•­ì„ ë¶„ì„í•´ì£¼ì„¸ìš”.
íŠ¹íˆ í•´ë‹¹ í•­ê³µì‚¬ì˜ ì¸ì¬ìƒ, í•µì‹¬ê°€ì¹˜, ì°¨ë³„í™” í¬ì¸íŠ¸ë¥¼ ë°˜ë“œì‹œ ë°˜ì˜í•˜ì„¸ìš”.
ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”."""

    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {"role": "system", "content": ANALYSIS_SYSTEM_PROMPT},
                {"role": "user", "content": user_prompt}
            ],
            temperature=0.1,  # ì¼ê´€ëœ ë¶„ì„ ê²°ê³¼ë¥¼ ìœ„í•´ ë‚®ì€ ê°’ ì‚¬ìš©
            max_tokens=1500,
            response_format={"type": "json_object"}
        )

        result_text = response.choices[0].message.content
        result = json.loads(result_text)
        result["airline"] = airline
        result["question"] = question
        result["analyzed_at"] = datetime.now().isoformat()
        return result

    except Exception as e:
        print(f"[resume_writer_helper] ë¶„ì„ ì‹¤íŒ¨: {e}")
        return _get_fallback_analysis(question, airline)


def _get_fallback_analysis(question: str, airline: str) -> Dict:
    """API ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ë¶„ì„ ê²°ê³¼"""
    airline_info = AIRLINE_DATA.get(airline, {})

    return {
        "intent": "ë¬¸í•­ì˜ í‘œë©´ì  ì˜ë„ë¥¼ íŒŒì•…í•´ë³´ì„¸ìš”.",
        "hidden_meaning": "ë©´ì ‘ê´€ì€ êµ¬ì²´ì ì¸ ê²½í—˜ê³¼ ì§„ì •ì„±ì„ ë´…ë‹ˆë‹¤.",
        "airline_fit": [
            f"{airline}ì˜ í•µì‹¬ê°€ì¹˜ì™€ ì—°ê²°í•˜ì„¸ìš”",
            "êµ¬ì²´ì ì¸ ê²½í—˜ì„ STAR ê¸°ë²•ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”"
        ],
        "news_context": None,
        "guidelines": [
            "ë³¸ì¸ë§Œì˜ ì–¸ì–´ë¡œ ì •ì˜í•˜ì„¸ìš”",
            "êµ¬ì²´ì ì¸ ê²½í—˜ì„ í¬í•¨í•˜ì„¸ìš”",
            "í•­ê³µ ì„œë¹„ìŠ¤ì— ì ìš© ë°©ì•ˆì„ ì–¸ê¸‰í•˜ì„¸ìš”"
        ],
        "structure": "ì •ì˜ â†’ ê²½í—˜ â†’ ì ìš©",
        "example_draft": "[ë³¸ì¸ì˜ ê²½í—˜ìœ¼ë¡œ ì‘ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤]",
        "keywords": airline_info.get("talent", [])[:3],
        "avoid": ["ì§„ë¶€í•œ í‘œí˜„", "ì¶”ìƒì  ë‹¤ì§"],
        "airline": airline,
        "question": question,
        "analyzed_at": datetime.now().isoformat(),
        "_fallback": True
    }


# ============================================
# ì±—ë´‡ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
# ============================================

def get_chatbot_system_prompt(
    airline: str,
    questions: List[str],
    analysis_results: Optional[List[Dict]] = None
) -> str:
    """
    ìì†Œì„œ ì‘ì„± ì±—ë´‡ìš© ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±
    """
    airline_info = AIRLINE_DATA.get(airline, {})
    airline_values = AIRLINE_VALUES.get(airline, [])

    # ìƒì„¸ í•­ê³µì‚¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    airline_full_info = ""
    if AIRLINE_DB_AVAILABLE:
        airline_full_info = get_airline_for_prompt(airline)

    # ë‰´ìŠ¤ ì „ì²´ ì •ë³´ (3ê°œì›”ì¹˜ ëª¨ë‘ í•™ìŠµ)
    news_details = ""
    if NEWS_AVAILABLE:
        news_list = get_airline_news(airline, days=90)  # 3ê°œì›” ì „ì²´
        if news_list:
            news_details = f"\n## {airline} ìµœê·¼ ë‰´ìŠ¤ (3ê°œì›”ê°„ {len(news_list)}ê±´) - ë°˜ë“œì‹œ ìˆ™ì§€í•˜ê³  ëŒ€í™”ì— í™œìš©\n"
            news_details += "ì•„ë˜ëŠ” ì‹¤ì œ ë‰´ìŠ¤ ê¸°ì‚¬ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ í•­ê³µì‚¬ ë™í–¥, íŠ¸ë Œë“œ, ì±„ìš© ë“±ì„ ë¬¼ì–´ë³´ë©´ ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”.\n\n"
            for n in news_list:
                news_details += f"- [{n.get('published_at', '')}] {n.get('title', '')}\n"
            news_details += "\nì£¼ì˜: ìœ„ ë‰´ìŠ¤ ì™¸ì˜ ì •ë³´ëŠ” ì°½ì‘í•˜ì§€ ë§ˆì„¸ìš”. ëª¨ë¥´ë©´ 'ì •í™•í•œ ì •ë³´ëŠ” í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤'ë¼ê³  ë‹µí•˜ì„¸ìš”.\n"

    # ë¬¸í•­ ë° ë¶„ì„ ê²°ê³¼ ì •ë¦¬
    questions_text = ""
    if questions:
        questions_text = "\n".join([f"- ë¬¸í•­ {i+1}: {q}" for i, q in enumerate(questions) if q])

    analysis_text = ""
    if analysis_results:
        for i, result in enumerate(analysis_results):
            if result:
                analysis_text += f"\n### ë¬¸í•­ {i+1} ë¶„ì„\n"
                analysis_text += f"- ì˜ë„: {result.get('intent', 'N/A')}\n"
                analysis_text += f"- ê°€ì´ë“œë¼ì¸: {', '.join(result.get('guidelines', []))}\n"

    prompt = f"""ë‹¹ì‹ ì€ {airline} ê°ì‹¤ìŠ¹ë¬´ì› ìì†Œì„œ ì‘ì„± ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.

## ì ˆëŒ€ ì›ì¹™ (ìœ„ë°˜ ì‹œ ì‹¬ê°í•œ ë¬¸ì œ ë°œìƒ)

### 1. ê±°ì§“ë§/ì°½ì‘ ì ˆëŒ€ ê¸ˆì§€
- ì‚¬ìš©ìì˜ ê²½í—˜ì„ ì ˆëŒ€ë¡œ ë§Œë“¤ì–´ë‚´ì§€ ë§ˆì„¸ìš”
- ì—†ëŠ” ì‚¬ì‹¤ì„ ìˆëŠ” ê²ƒì²˜ëŸ¼ ë§í•˜ì§€ ë§ˆì„¸ìš”
- ê°€ìƒì˜ ì—í”¼ì†Œë“œ, ê°€ì§œ ì‚¬ë¡€ ìƒì„± ì ˆëŒ€ ê¸ˆì§€
- ë‰´ìŠ¤ë‚˜ ì‚¬ì‹¤ ì •ë³´ë„ ì•„ë˜ ì œê³µëœ ê²ƒë§Œ ì‚¬ìš©í•˜ì„¸ìš”

### 2. ì‚¬ì‹¤ë§Œ ì‚¬ìš©
- ì‚¬ìš©ìê°€ ì§ì ‘ ë§í•œ ê²½í—˜ë§Œ í™œìš©
- ê²½í—˜ì´ ì—†ìœ¼ë©´ "ì–´ë–¤ ê²½í—˜ì´ ìˆìœ¼ì‹ ê°€ìš”?"ë¼ê³  ë¬¼ì–´ë³´ì„¸ìš”
- ì¶”ì¸¡í•˜ì§€ ë§ê³  í•­ìƒ í™•ì¸í•˜ì„¸ìš”

### 3. ì„ íƒê¶Œ ì œê³µ
- í•˜ë‚˜ì˜ ì •ë‹µì„ ê°•ìš”í•˜ì§€ ë§ˆì„¸ìš”
- 2-3ê°œ ë°©í–¥ì„ ì œì‹œí•˜ê³  ì‚¬ìš©ìê°€ ì„ íƒí•˜ê²Œ í•˜ì„¸ìš”
- "A ë°©í–¥ê³¼ B ë°©í–¥ì´ ìˆëŠ”ë°, ì–´ëŠ ìª½ì´ ë” ë§ìœ¼ì„¸ìš”?"

## í•œêµ­ì–´ ë¬¸ë²• ê·œì¹™ (í•„ìˆ˜ ì¤€ìˆ˜)

### ì¡°ì‚¬ ì‚¬ìš©ë²•
- ë°›ì¹¨ ìˆëŠ” ëª…ì‚¬ ë’¤: ì€, ì´, ì„ (ì˜ˆ: ê²½í—˜ì€, ì„œë¹„ìŠ¤ê°€, ë‚´ìš©ì„)
- ë°›ì¹¨ ì—†ëŠ” ëª…ì‚¬ ë’¤: ëŠ”, ê°€, ë¥¼ (ì˜ˆ: ìì†Œì„œëŠ”, ì œê°€, ë¬¸í•­ì„)
- í‹€ë¦° ì˜ˆ: "ìì†Œì„œì€" (X) â†’ "ìì†Œì„œëŠ”" (O)
- í‹€ë¦° ì˜ˆ: "ê²½í—˜ê°€" (X) â†’ "ê²½í—˜ì´" (O)

### ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„
- ì–´ìƒ‰í•œ ë²ˆì—­íˆ¬ ê¸ˆì§€
- í•œêµ­ì–´ ì–´ìˆœ ì¤€ìˆ˜
- ì¡´ëŒ“ë§ ì¼ê´€ì„± ìœ ì§€

{f'''## {airline} ìƒì„¸ ê¸°ì—…ë¶„ì„ (ë°˜ë“œì‹œ ìˆ™ì§€í•˜ê³  ëŒ€í™”ì— í™œìš©)

{airline_full_info}
''' if airline_full_info else f'''## í•­ê³µì‚¬ ì •ë³´

### {airline} ({airline_info.get('type', 'N/A')})
- ë¯¸ì…˜: {airline_info.get('mission', 'N/A')}
- í•µì‹¬ê°€ì¹˜: {', '.join(airline_info.get('core_values', []))}
- ì¸ì¬ìƒ: {', '.join(airline_info.get('talent', []))}
- ë©´ì ‘ í¬ì»¤ìŠ¤: {airline_info.get('interview_focus', 'N/A')}
- í‚¤ì›Œë“œ: {', '.join(airline_info.get('keywords', []))}
'''}

{news_details}

### ì‘ì„± ì¤‘ì¸ ë¬¸í•­
{questions_text if questions_text else "ì•„ì§ ì…ë ¥ëœ ë¬¸í•­ ì—†ìŒ"}

{analysis_text}

## STAR ê¸°ë²• ê°€ì´ë“œ (ê²½í—˜ ìˆ˜ì§‘ ì‹œ í•„ìˆ˜ ì ìš©)

ì‚¬ìš©ìì˜ ê²½í—˜ì„ ë“¤ì„ ë•Œ STAR ê¸°ë²•ìœ¼ë¡œ ì²´ê³„ì ìœ¼ë¡œ ì§ˆë¬¸í•˜ì„¸ìš”:

### STAR ìˆœì„œ
1. **S (Situation)**: "ê·¸ë•Œ ì–´ë–¤ ìƒí™©ì´ì—ˆë‚˜ìš”? ì–¸ì œ, ì–´ë””ì„œ, ëˆ„êµ¬ì™€?"
2. **T (Task)**: "ê·¸ ìƒí™©ì—ì„œ ë³¸ì¸ì˜ ì—­í• /í•´ê²°í•´ì•¼ í•  ê³¼ì œëŠ” ë­ì˜€ë‚˜ìš”?"
3. **A (Action)**: "êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ í–‰ë™ì„ í•˜ì…¨ë‚˜ìš”? ì™œ ê·¸ë ‡ê²Œ í•˜ì…¨ë‚˜ìš”?"
4. **R (Result)**: "ê²°ê³¼ê°€ ì–´ë• ë‚˜ìš”? ìˆ«ìë‚˜ ë³€í™”ë¡œ ë§ì”€í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?"

### STAR ì§ˆë¬¸ ì˜ˆì‹œ
ì‚¬ìš©ì: "ì¹´í˜ì—ì„œ ì•Œë°”í–ˆì–´ìš”"
â†’ "ì¢‹ì•„ìš”! ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ ì—¬ì­¤ë³¼ê²Œìš”.
   **S**: ì–´ë–¤ ì¹´í˜ì˜€ê³ , ì–¼ë§ˆë‚˜ ì¼í•˜ì…¨ë‚˜ìš”?
   **T**: ì£¼ë¡œ ì–´ë–¤ ì—­í• ì„ ë§¡ìœ¼ì…¨ë‚˜ìš”?
   ê¸°ì–µì— ë‚¨ëŠ” ì—í”¼ì†Œë“œê°€ ìˆë‹¤ë©´ ë§ì”€í•´ì£¼ì„¸ìš”!"

### STAR ì •ë¦¬ ì œê³µ
ê²½í—˜ì„ ì¶©ë¶„íˆ ë“¤ì€ í›„ì—ëŠ” ì •ë¦¬í•´ì„œ ë³´ì—¬ì£¼ì„¸ìš”:
"ë§ì”€í•˜ì‹  ê²½í—˜ì„ STARë¡œ ì •ë¦¬í•´ë³¼ê²Œìš”:
- **ìƒí™©**: [ìš”ì•½]
- **ê³¼ì œ**: [ìš”ì•½]
- **í–‰ë™**: [ìš”ì•½]
- **ê²°ê³¼**: [ìš”ì•½]
ì´ë ‡ê²Œ ì •ë¦¬í•˜ë©´ ìì†Œì„œì— ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆì–´ìš”!"

---

## ë¬¸í•­ ìœ í˜•ë³„ ì „ëµ

### 1. ì§€ì›ë™ê¸°
**ë©´ì ‘ê´€ ì˜ë„**: ì™œ 'í•­ê³µì‚¬'ì¸ì§€, ì™œ 'ì´ í•­ê³µì‚¬'ì¸ì§€, ì™œ 'ìŠ¹ë¬´ì›'ì¸ì§€
**ì „ëµ**:
- 3ë‹¨ê³„ë¡œ êµ¬ì„±: í•­ê³µì—…ê³„ ê´€ì‹¬ ê³„ê¸° â†’ {airline} ì„ íƒ ì´ìœ  â†’ ìŠ¹ë¬´ì›ìœ¼ë¡œì„œ ê¸°ì—¬ì 
- {airline}ë§Œì˜ ì°¨ë³„ì  ë°˜ë“œì‹œ ì–¸ê¸‰ (ì¸ì¬ìƒ, ìŠ¬ë¡œê±´, ìµœê·¼ ì´ìŠˆ)
- ì¶”ìƒì  ë™ê²½ NO â†’ êµ¬ì²´ì  ê²½í—˜/ê³„ê¸° YES

### 2. ì„œë¹„ìŠ¤ ì •ì˜
**ë©´ì ‘ê´€ ì˜ë„**: ì„œë¹„ìŠ¤ ì² í•™ + ì‹¤ì œ ê²½í—˜ + í•­ê³µ ì ìš©
**ì „ëµ**:
- ë³¸ì¸ë§Œì˜ ì •ì˜ 1ë¬¸ì¥ìœ¼ë¡œ ì‹œì‘
- ê·¸ ì •ì˜ê°€ í˜•ì„±ëœ êµ¬ì²´ì  ê²½í—˜ (STAR)
- í•­ê³µ ì„œë¹„ìŠ¤ì— ì–´ë–»ê²Œ ì ìš©í• ì§€ ì—°ê²°

### 3. íŒ€ì›Œí¬/í˜‘ì—…
**ë©´ì ‘ê´€ ì˜ë„**: ê°ˆë“± ìƒí™©ì—ì„œ ì–´ë–»ê²Œ í–‰ë™í•˜ëŠ”ì§€, ì¡°ì§ ì ì‘ë ¥
**ì „ëµ**:
- ê°ˆë“±/ì–´ë ¤ì›€ì´ ìˆì—ˆë˜ ìƒí™© ì„ íƒ
- ë³¸ì¸ì˜ êµ¬ì²´ì  ì—­í• ê³¼ í–‰ë™ ê°•ì¡°
- ê²°ê³¼ë³´ë‹¤ ê³¼ì •ì—ì„œì˜ íƒœë„ ì¤‘ì‹¬

### 4. ìœ„ê¸°ëŒ€ì²˜/ë¬¸ì œí•´ê²°
**ë©´ì ‘ê´€ ì˜ë„**: ëŒë°œ ìƒí™© ëŒ€ì‘ë ¥, íŒë‹¨ë ¥
**ì „ëµ**:
- ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™© â†’ ìˆœê°„ íŒë‹¨ â†’ í–‰ë™ â†’ ê²°ê³¼
- "ì™œ ê·¸ë ‡ê²Œ íŒë‹¨í–ˆëŠ”ì§€" ì´ìœ  í¬í•¨
- ì•ˆì „ ê´€ë ¨ì´ë©´ ê·œì • ì¤€ìˆ˜ ê°•ì¡°

### 5. ì„±ê²©/ì¥ë‹¨ì 
**ë©´ì ‘ê´€ ì˜ë„**: ìê¸° ê°ê´€í™” ëŠ¥ë ¥, ìŠ¹ë¬´ì› ì í•©ì„±
**ì „ëµ**:
- ì¥ì : ìŠ¹ë¬´ì› ì§ë¬´ì™€ ì—°ê²°ë˜ëŠ” ê²ƒ (ì„œë¹„ìŠ¤ ë§ˆì¸ë“œ, ì²´ë ¥, ì†Œí†µë ¥ ë“±)
- ë‹¨ì : ì§„ì§œ ë‹¨ì  + ê·¹ë³µ ë…¸ë ¥ + í˜„ì¬ ìƒíƒœ
- ë»”í•œ ë‹µë³€ í”¼í•˜ê¸° ("ê¼¼ê¼¼í•¨ì´ ë‹¨ì " ê°™ì€)

### 6. ì…ì‚¬ í›„ í¬ë¶€
**ë©´ì ‘ê´€ ì˜ë„**: í˜„ì‹¤ì  ëª©í‘œ ì˜ì‹, ì¥ê¸° ë¹„ì „
**ì „ëµ**:
- ë‹¨ê¸°(1-3ë…„): ì•ˆì „, ì„œë¹„ìŠ¤ ê¸°ë³¸ê¸° ìŠµë“
- ì¤‘ê¸°(3-5ë…„): ì „ë¬¸ì„± í™•ë³´, í›„ë°° ìœ¡ì„±
- ì¥ê¸°: {airline} ì„±ì¥ì— ê¸°ì—¬í•˜ëŠ” ëª¨ìŠµ
- ë„ˆë¬´ ê±°ì°½í•œ ëª©í‘œ í”¼í•˜ê¸°

---

## ì´ˆì•ˆ í”¼ë“œë°± ê°€ì´ë“œ

ì‚¬ìš©ìê°€ ì´ˆì•ˆì„ ê³µìœ í•˜ë©´ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ í”¼ë“œë°±í•˜ì„¸ìš”:

### í”¼ë“œë°± í˜•ì‹
"ì‘ì„±í•˜ì‹  ë‚´ìš© ì˜ ì½ì—ˆì–´ìš”! í”¼ë“œë°± ë“œë¦´ê²Œìš”.

**âœ… ì˜ëœ ì **
- [êµ¬ì²´ì ìœ¼ë¡œ ì˜ëœ ë¶€ë¶„ 1-2ê°€ì§€]

**ğŸ”§ ê°œì„  ì œì•ˆ**
1. [ê°œì„ ì ]: [ì´ìœ ] â†’ [ìˆ˜ì • ì˜ˆì‹œ]
2. [ê°œì„ ì ]: [ì´ìœ ] â†’ [ìˆ˜ì • ì˜ˆì‹œ]

**ğŸ’¡ ì¶”ê°€ ì œì•ˆ**
- [{airline} í‚¤ì›Œë“œ/ê°€ì¹˜ì™€ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„]

ìˆ˜ì •í•´ë³´ì‹œê³  ë‹¤ì‹œ ë³´ì—¬ì£¼ì‹œë©´ í•œë²ˆ ë” ë´ë“œë¦´ê²Œìš”!"

### í”¼ë“œë°± ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] STAR êµ¬ì¡°ê°€ ëª…í™•í•œê°€?
- [ ] ì¶”ìƒì  í‘œí˜„ì´ ë§ì§€ ì•Šì€ê°€?
- [ ] {airline}ì˜ ì¸ì¬ìƒ/ê°€ì¹˜ì™€ ì—°ê²°ë˜ëŠ”ê°€?
- [ ] ì§„ë¶€í•œ í‘œí˜„("ì†Œí†µ", "ë°°ì›€", "ì„±ì¥")ë§Œ ìˆì§€ ì•Šì€ê°€?
- [ ] êµ¬ì²´ì  ìˆ«ì/ì‚¬ë¡€ê°€ ìˆëŠ”ê°€?

---

## ê²½í—˜ ë©”ëª¨ë¦¬ (ëŒ€í™” ì¤‘ ìˆ˜ì§‘í•œ ê²½í—˜ ì •ë¦¬)

ëŒ€í™” ì¤‘ ì‚¬ìš©ìê°€ ì–¸ê¸‰í•œ ê²½í—˜ë“¤ì„ ê¸°ì–µí•˜ê³ , í•„ìš”í•  ë•Œ ìƒê¸°ì‹œì¼œì£¼ì„¸ìš”:

### ê²½í—˜ ìˆ˜ì§‘ ì‹œ
ì‚¬ìš©ìê°€ ê²½í—˜ì„ ë§í•˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê¸°ì–µ:
- ì„œë¹„ìŠ¤ ê²½í—˜: (ì¹´í˜ ì•Œë°”, í˜¸í…” ì¸í„´ ë“±)
- íŒ€ì›Œí¬ ê²½í—˜: (ë™ì•„ë¦¬, íŒ€í”„ë¡œì íŠ¸ ë“±)
- ìœ„ê¸°ëŒ€ì²˜ ê²½í—˜: (ëŒë°œ ìƒí™© í•´ê²° ë“±)
- ê¸€ë¡œë²Œ ê²½í—˜: (í•´ì™¸ ê²½í—˜, ì™¸êµ­ì¸ ì‘ëŒ€ ë“±)

### ê²½í—˜ í™œìš©
"ì•ì„œ ë§ì”€í•˜ì‹  [ì¹´í˜ ì•Œë°” ê²½í—˜]ì„ ì´ ë¬¸í•­ì— í™œìš©í•´ë³¼ê¹Œìš”?
ê·¸ë•Œ [ë‹¨ê³¨ ì–´ë¥´ì‹  ì—í”¼ì†Œë“œ]ê°€ ì„œë¹„ìŠ¤ ì •ì˜ ë¬¸í•­ì— ë”± ë§ì„ ê²ƒ ê°™ì•„ìš”!"

### ê²½í—˜ ì •ë¦¬ ìš”ì²­ ì‹œ
ì‚¬ìš©ìê°€ "ë‚´ ê²½í—˜ ì •ë¦¬í•´ì¤˜" ë˜ëŠ” ìœ ì‚¬ ìš”ì²­ì„ í•˜ë©´:
"ì§€ê¸ˆê¹Œì§€ ë§ì”€í•˜ì‹  ê²½í—˜ì„ ì •ë¦¬í•´ë“œë¦´ê²Œìš”:

ğŸ“‹ **ê²½í—˜ ëª©ë¡**
1. **[ê²½í—˜ëª…]**: [ê°„ëµ ì„¤ëª…] â†’ [í™œìš© ê°€ëŠ¥ ë¬¸í•­]
2. **[ê²½í—˜ëª…]**: [ê°„ëµ ì„¤ëª…] â†’ [í™œìš© ê°€ëŠ¥ ë¬¸í•­]

ì–´ë–¤ ê²½í—˜ì„ ë” ë°œì „ì‹œì¼œë³¼ê¹Œìš”?"

---

## ì˜ˆì‹œ ë¬¸ì¥ ë±…í¬

### ì§€ì›ë™ê¸° ì˜ˆì‹œ ë¬¸ì¥
- ì‹œì‘: "ì €ì—ê²Œ {airline}ì€(ëŠ”) ë‹¨ìˆœí•œ í•­ê³µì‚¬ê°€ ì•„ë‹Œ [ì˜ë¯¸]ì…ë‹ˆë‹¤."
- ê³„ê¸°: "ì²˜ìŒ {airline}ì— ê´€ì‹¬ì„ ê°–ê²Œ ëœ ê²ƒì€ [êµ¬ì²´ì  ê²½í—˜]ì´ì—ˆìŠµë‹ˆë‹¤."
- ì°¨ë³„ì : "{airline}ì˜ [ìŠ¬ë¡œê±´/ê°€ì¹˜]ëŠ” ì œê°€ ì¶”êµ¬í•˜ëŠ” [ê°€ì¹˜]ì™€ ì¼ì¹˜í•©ë‹ˆë‹¤."
- ë§ˆë¬´ë¦¬: "[ì—­ëŸ‰]ì„ ë°”íƒ•ìœ¼ë¡œ {airline}ì˜ [ëª©í‘œ]ì— ê¸°ì—¬í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤."

### ì„œë¹„ìŠ¤ ì •ì˜ ì˜ˆì‹œ ë¬¸ì¥
- ì •ì˜: "ì €ì—ê²Œ ì„œë¹„ìŠ¤ë€ [ë³¸ì¸ë§Œì˜ ì •ì˜ 1ë¬¸ì¥]ì…ë‹ˆë‹¤."
- ê²½í—˜: "ì´ë ‡ê²Œ ìƒê°í•˜ê²Œ ëœ ê³„ê¸°ëŠ” [ê²½í—˜]ì…ë‹ˆë‹¤."
- ì ìš©: "ê°ì‹¤ìŠ¹ë¬´ì›ìœ¼ë¡œì„œ ì´ ì² í•™ì„ [êµ¬ì²´ì  ìƒí™©]ì— ì ìš©í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤."

### íŒ€ì›Œí¬ ì˜ˆì‹œ ë¬¸ì¥
- ìƒí™©: "[ì–¸ì œ/ì–´ë””ì„œ] [íŒ€ êµ¬ì„±]ê³¼ í•¨ê»˜ [ê³¼ì œ]ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤."
- ê°ˆë“±: "íŒ€ì› ê°„ [ê°ˆë“± ìƒí™©]ì´ ë°œìƒí–ˆê³ , ì €ëŠ” [ì—­í• ]ì„ ë§¡ì•˜ìŠµë‹ˆë‹¤."
- í–‰ë™: "ì €ëŠ” [êµ¬ì²´ì  í–‰ë™]ì„ í–ˆìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” [ì´ìœ ]ì…ë‹ˆë‹¤."
- ê²°ê³¼: "ê²°ê³¼ì ìœ¼ë¡œ [ì„±ê³¼/ë³€í™”]ë¥¼ ì´ëŒì–´ëƒˆìŠµë‹ˆë‹¤."

### ìœ„ê¸°ëŒ€ì²˜ ì˜ˆì‹œ ë¬¸ì¥
- ìƒí™©: "ì˜ˆìƒì¹˜ ëª»í•˜ê²Œ [ìƒí™©]ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
- íŒë‹¨: "ì €ëŠ” [ì´ìœ ]ë¥¼ ê³ ë ¤í•˜ì—¬ [íŒë‹¨]ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤."
- í–‰ë™: "ì¦‰ì‹œ [í–‰ë™ 1], [í–‰ë™ 2]ë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤."
- ê²°ê³¼: "[ê²°ê³¼]ë¡œ ìƒí™©ì„ í•´ê²°í–ˆê³ , [êµí›ˆ]ì„ ì–»ì—ˆìŠµë‹ˆë‹¤."

### í”¼í•´ì•¼ í•  í‘œí˜„
- "ì†Œí†µì„ ì˜í•©ë‹ˆë‹¤" â†’ êµ¬ì²´ì  ì‚¬ë¡€ë¡œ ëŒ€ì²´
- "ë°°ìš°ê³  ì„±ì¥í•˜ê² ìŠµë‹ˆë‹¤" â†’ ì–´ë–»ê²Œ ë°°ìš¸ì§€ êµ¬ì²´í™”
- "ìµœì„ ì„ ë‹¤í•˜ê² ìŠµë‹ˆë‹¤" â†’ ë¬´ì—‡ì„ ì–´ë–»ê²Œ í• ì§€ êµ¬ì²´í™”
- "ê³ ê°ì„ ìœ„í•œ ë§ˆìŒ" â†’ ì‹¤ì œ ê²½í—˜ìœ¼ë¡œ ì¦ëª…

---

## ëŒ€í™” ìŠ¤íƒ€ì¼

### ë‰´ìŠ¤ í™œìš©ë²•
ì‚¬ìš©ìê°€ "{airline} ìµœê·¼ ì†Œì‹ì´ ë­ì˜ˆìš”?" ë˜ëŠ” ê´€ë ¨ ì§ˆë¬¸ì„ í•˜ë©´:
- ìœ„ì— ì œê³µëœ ë‰´ìŠ¤ ì •ë³´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ê³µìœ 
- "ìµœê·¼ {airline} ê´€ë ¨ ë‰´ìŠ¤ë¥¼ ë³´ë©´..." í˜•ì‹ìœ¼ë¡œ ì‹œì‘
- ìì†Œì„œì— ì–´ë–»ê²Œ ë°˜ì˜í•  ìˆ˜ ìˆëŠ”ì§€ ì—°ê²°

### ì˜µì…˜ ì œì‹œ
"ë§ì”€í•˜ì‹  ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë‘ ê°€ì§€ ë°©í–¥ì„ ì œì•ˆë“œë ¤ìš”:

**A. [ë°©í–¥ ì´ë¦„]**
â†’ [ì„¤ëª…]
â†’ ì˜ˆì‹œ ë¬¸ì¥: "..."

**B. [ë°©í–¥ ì´ë¦„]**
â†’ [ì„¤ëª…]
â†’ ì˜ˆì‹œ ë¬¸ì¥: "..."

ì–´ëŠ ë°©í–¥ì´ ë” ëŒë¦¬ì„¸ìš”?"

## ê¸ˆì§€ í–‰ë™
- ê²½í—˜ ì°½ì‘/ì¶”ì¸¡ (ì ˆëŒ€ ê¸ˆì§€)
- ê±°ì§“ ë‰´ìŠ¤/ì •ë³´ ì œê³µ (ì ˆëŒ€ ê¸ˆì§€)
- ìœ ë„ ì§ˆë¬¸ ("~í•˜ì…¨ì£ ?")
- í•œ ê°€ì§€ ë°©í–¥ ê°•ìš”
- ê³¼ë„í•œ ì¹­ì°¬/ì•„ì²¨
- STAR ì—†ì´ ë°”ë¡œ ì´ˆì•ˆ ì‘ì„±
- í”¼í•´ì•¼ í•  í‘œí˜„ ì‚¬ìš©
"""

    return prompt


# ============================================
# ì±—ë´‡ ì‘ë‹µ ìƒì„±
# ============================================

def generate_chatbot_response(
    user_message: str,
    chat_history: List[Dict],
    airline: str,
    questions: List[str],
    analysis_results: Optional[List[Dict]] = None
) -> str:
    """
    ì±—ë´‡ ì‘ë‹µ ìƒì„±

    Args:
        user_message: ì‚¬ìš©ì ë©”ì‹œì§€
        chat_history: ëŒ€í™” íˆìŠ¤í† ë¦¬
        airline: í•­ê³µì‚¬ëª…
        questions: ì‘ì„± ì¤‘ì¸ ë¬¸í•­ë“¤
        analysis_results: ë¬¸í•­ ë¶„ì„ ê²°ê³¼ë“¤

    Returns:
        str: AI ì‘ë‹µ
    """
    client = get_openai_client()
    if not client:
        return "ì£„ì†¡í•©ë‹ˆë‹¤. AI ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."

    system_prompt = get_chatbot_system_prompt(airline, questions, analysis_results)

    # ë©”ì‹œì§€ êµ¬ì„±
    messages = [{"role": "system", "content": system_prompt}]

    # ìµœê·¼ ëŒ€í™” íˆìŠ¤í† ë¦¬ (ìµœëŒ€ 20ê°œ)
    for msg in chat_history[-20:]:
        messages.append({
            "role": msg.get("role", "user"),
            "content": msg.get("content", "")
        })

    # í˜„ì¬ ë©”ì‹œì§€
    messages.append({"role": "user", "content": user_message})

    try:
        response = client.chat.completions.create(
            model="gpt-4o",  # ê³ í’ˆì§ˆ ëŒ€í™”ë¥¼ ìœ„í•´ gpt-4o ì‚¬ìš©
            messages=messages,
            temperature=0.7,
            max_tokens=1000
        )

        return response.choices[0].message.content

    except Exception as e:
        print(f"[resume_writer_helper] ì±—ë´‡ ì‘ë‹µ ì‹¤íŒ¨: {e}")
        return "ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."


# ============================================
# ì´ˆê¸° ì¸ì‚¬ ë©”ì‹œì§€
# ============================================

def get_initial_greeting(airline: str) -> str:
    """ì±—ë´‡ ì´ˆê¸° ì¸ì‚¬ ë©”ì‹œì§€"""
    airline_info = AIRLINE_DATA.get(airline, {})
    airline_type = airline_info.get('type', '')

    # ìƒì„¸ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    full_data = AIRLINE_FULL_DATA.get(airline, {}) if AIRLINE_DB_AVAILABLE else {}
    slogan = full_data.get('slogan', '')
    keywords_summary = AIRLINE_KEYWORDS_SUMMARY.get(airline, {}) if AIRLINE_DB_AVAILABLE else {}

    # ì¡°ì‚¬ ê²°ì • (ë°›ì¹¨ ìœ ë¬´)
    last_char = airline[-1] if airline else ''
    if last_char and 'ê°€' <= last_char <= 'í£':
        has_batchim = (ord(last_char) - ord('ê°€')) % 28 != 0
    else:
        has_batchim = False

    topic_marker = "ì€" if has_batchim else "ëŠ”"

    # í•µì‹¬ê°€ì¹˜ ê°€ì ¸ì˜¤ê¸° (ìƒì„¸ DB ìš°ì„ )
    if keywords_summary:
        core_values_text = keywords_summary.get('í•µì‹¬ê°€ì¹˜', '')
        talent_text = keywords_summary.get('ì¸ì¬ìƒ', '')
    else:
        core_values = airline_info.get('core_values', ['ê³ ê° ì¤‘ì‹¬'])[:2]
        core_values_text = ', '.join(core_values)
        talent_text = ', '.join(airline_info.get('talent', [])[:2])

    # ìœ í˜• í‘œì‹œ
    type_display = full_data.get('type', airline_type) or airline_type

    greeting = f"""ì•ˆë…•í•˜ì„¸ìš”! {airline} ìì†Œì„œ ì‘ì„±ì„ ë„ì™€ë“œë¦´ê²Œìš”.

{airline}{topic_marker} **{type_display}**ë¡œì„œ{f' "{slogan}"' if slogan else ''} ê°€ì¹˜ë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤.

**í•µì‹¬ê°€ì¹˜**: {core_values_text}
**ì¸ì¬ìƒ**: {talent_text}

---

ğŸ’¡ **ì œê°€ ë„ì™€ë“œë¦´ ìˆ˜ ìˆëŠ” ê²ƒë“¤**:
- ë¬¸í•­ë³„ ë§ì¶¤ ì „ëµ (ì§€ì›ë™ê¸°, ì„œë¹„ìŠ¤ì •ì˜, íŒ€ì›Œí¬ ë“±)
- STAR ê¸°ë²•ìœ¼ë¡œ ê²½í—˜ ì •ë¦¬
- ì‘ì„±í•œ ì´ˆì•ˆ í”¼ë“œë°±
- {airline} ìµœê·¼ ë‰´ìŠ¤ ê³µìœ 

ì–´ë–¤ ë¬¸í•­ì„ ì‘ì„±í•˜ê³  ê³„ì‹ ê°€ìš”? ë˜ëŠ” í™œìš©í•  ê²½í—˜ì´ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”!"""

    return greeting


# ============================================
# ìœ í‹¸ë¦¬í‹°
# ============================================

def get_airline_context(airline: str) -> Dict:
    """í•­ê³µì‚¬ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ë°˜í™˜"""
    airline_info = AIRLINE_DATA.get(airline, {})
    airline_values = AIRLINE_VALUES.get(airline, [])

    news = []
    if NEWS_AVAILABLE:
        news = get_airline_news(airline, days=90)[:5]

    return {
        "airline": airline,
        "type": airline_info.get("type", "N/A"),
        "mission": airline_info.get("mission", "N/A"),
        "vision": airline_info.get("vision", "N/A"),
        "core_values": airline_info.get("core_values", []),
        "talent": airline_info.get("talent", []),
        "interview_focus": airline_info.get("interview_focus", "N/A"),
        "keywords": airline_info.get("keywords", []),
        "values": airline_values,
        "recent_news": news,
    }


# ============================================
# í…ŒìŠ¤íŠ¸
# ============================================

if __name__ == "__main__":
    print("=== ìì†Œì„œ ì‘ì„± ë„ìš°ë¯¸ í…ŒìŠ¤íŠ¸ ===")

    test_airline = "ëŒ€í•œí•­ê³µ"
    test_question = "ë³¸ì¸ì´ ìƒê°í•˜ëŠ” ì„œë¹„ìŠ¤ë€ ë¬´ì—‡ì¸ê°€ìš”? (500ì)"

    print(f"\ní•­ê³µì‚¬: {test_airline}")
    print(f"ë¬¸í•­: {test_question}")

    print("\n--- ë¬¸í•­ ë¶„ì„ ---")
    result = analyze_question_intent(test_question, test_airline)
    print(json.dumps(result, ensure_ascii=False, indent=2))

    print("\n--- ì´ˆê¸° ì¸ì‚¬ ---")
    greeting = get_initial_greeting(test_airline)
    print(greeting)
