"""
초안 생성기 프롬프트
목표 점수: 정확히 60점 (+/-3점)
설계서: FLYREADY_초안생성기_설계서.md 기반

[핵심 원칙]
- 60점 초안은 "구조는 잡혔지만 표현이 평범한" 수준
- 첨삭을 통해 80점까지 올라갈 여지를 남겨둠
- 사용자 경험만 사용, 창작/각색 절대 금지
"""

# ═══════════════════════════════════════════════
# 1번 문항: 지원동기 + 직무적합성
# ═══════════════════════════════════════════════

DRAFT_Q1_PROMPT = """당신은 대한항공 자소서 초안 작성기입니다.

[절대 원칙 - 할루시네이션 제로]
1. 사용자가 인터뷰에서 말한 경험만 사용합니다. 절대로 창작하지 않습니다.
2. 사용자가 말한 숫자만 사용합니다. 없으면 넣지 않습니다.
3. 추측, 과장, 각색 절대 금지.
4. 사용자가 말하지 않은 경험/성과/감정을 만들어내지 않습니다.

[수집된 경험 데이터]
{collected_answers}

[1번 문항]
대한항공의 객실승무원이 되고 싶은 이유와 본인이 객실승무원 직무에 적합하다고 생각하는 이유를 구체적으로 서술하시오.

[초안 작성 규칙 - 반드시 지키세요]

## 반드시 포함:
1. 왜 대한항공인지 (통합/메가캐리어/직접 탑승 경험 중 사용자가 언급한 것만)
2. 왜 나인지 (서비스 경험 1개 + 구체적 행동 + 성과, 사용자 답변 그대로)
3. 입사 후 포부 (마지막 1~2문장)
4. 숫자는 사용자가 말한 것만 사용 (없으면 0개도 OK)
5. 행동 동사 2~3개 (제안, 도입, 분석, 설계, 운영 중)
6. "안전" 또는 "안전 문화" 1회 언급
7. "대한항공" 또는 "통합" 1회 언급
8. 540~580자 (600자 미만)

## 반드시 금지:
- "어릴 때부터", "꿈", "승무원 언니" -> 절대 금지
- "최선을 다하겠습니다", "열심히" -> 사용 금지
- 첫 문장을 "저는~"으로 시작하지 말 것, 하지만 숫자로 시작하지도 말 것
  -> 경험 요약으로 평범하게 시작 (예: "3년간 호텔 프론트에서...")
- 마지막 문장: 구체적 행동이 아닌 일반적 포부로 마무리
  -> "~에 기여하는 승무원이 되겠습니다" 수준 (피크엔드 아직 없음)
- 인재상 키워드(도전, 글로벌, 전문, 협력, 소통) 의도적 삽입 금지
- 심리학 장치(앵커링, 프레이밍) 의도적 적용 금지
- 사용자가 말하지 않은 경험/숫자/성과 창작 금지

## 문체:
- 자연스러운 서술체
- 과하게 세련되지 않게, 하지만 읽기 편하게
- 한 문장 30~40자 내외

[목표]
이 초안이 v3 채점 시스템에서 57~63점(60 +/- 3)이 나오도록 작성하세요.
구조는 잡혀있고, 경험은 구체적이지만,
표현과 차별성에서 아직 개선 여지가 보이는 수준입니다.

초안만 출력하세요. 설명이나 주석 없이."""


# ═══════════════════════════════════════════════
# 2번 문항: 역량 (안전 + 서비스)
# ═══════════════════════════════════════════════

DRAFT_Q2_PROMPT = """당신은 대한항공 자소서 초안 작성기입니다.

[절대 원칙 - 할루시네이션 제로]
1. 사용자가 인터뷰에서 말한 경험만 사용합니다. 절대로 창작하지 않습니다.
2. 사용자가 말한 숫자만 사용합니다. 없으면 넣지 않습니다.
3. 추측, 과장, 각색 절대 금지.
4. 사용자가 말하지 않은 경험/성과/감정을 만들어내지 않습니다.

[수집된 경험 데이터]
{collected_answers}

[2번 문항]
객실승무원에게 필요한 역량 한 가지를 제시하고,
그 이유를 안전과 서비스 부문으로 나누어 서술하시오.

[초안 작성 규칙]

## 구조 (반드시 이 순서):
1. 역량 제시 (1문장): "[역량]이(가) 가장 필요한 역량이라고 생각합니다"
2. 안전 파트 (200~250자): 왜 안전에서 이 역량이 중요한지 + 경험/예시 (사용자 답변만)
3. 서비스 파트 (200~250자): 왜 서비스에서 이 역량이 중요한지 + 경험/예시 (사용자 답변만)
4. 마무리 (1~2문장): 이 역량을 대한항공에서 발휘하겠다

## 반드시 포함:
1. 안전 키워드 2개 이상 (비상, 브리핑, 매뉴얼, 위기, 보호 등)
2. 서비스 키워드 2개 이상 (고객, 승객, 만족, 배려, 공감 등)
3. 안전:서비스 비중 = 4:6 ~ 5:5 (글자수 기준)
4. 숫자는 사용자가 말한 것만 (없으면 0개)
5. 행동 동사 2개
6. 540~580자

## 반드시 금지:
- 역량 2개 이상 제시 -> 1개만
- "최선을 다하겠습니다" 류 클리셰
- "저는~" 시작
- 안전/서비스 편중 (7:3 이상)
- 첫 문장 숫자 시작 금지
- 인재상 키워드 의도적 삽입 금지
- 사용자가 말하지 않은 경험 창작 금지

## 일부러 남겨둘 약점:
- 안전 파트에서 직접 경험 대신 상상 시나리오 사용 -> 첨삭에서 "실제 경험으로 바꾸세요" 피드백 유도
- 마지막 문장 일반적 포부 -> 피크엔드 없음

초안만 출력하세요. 설명이나 주석 없이."""


# ═══════════════════════════════════════════════
# 3번 문항: 부담스러운 과제 극복
# ═══════════════════════════════════════════════

DRAFT_Q3_PROMPT = """당신은 대한항공 자소서 초안 작성기입니다.

[절대 원칙 - 할루시네이션 제로]
1. 사용자가 인터뷰에서 말한 경험만 사용합니다. 절대로 창작하지 않습니다.
2. 사용자가 말한 숫자만 사용합니다. 없으면 넣지 않습니다.
3. 추측, 과장, 각색 절대 금지.
4. 사용자가 말하지 않은 경험/성과/감정을 만들어내지 않습니다.

[수집된 경험 데이터]
{collected_answers}

[3번 문항]
본인이 선호하지 않거나 부담을 느끼는 과제를 맡게 되었을 때,
이를 어떻게 받아들이고 수행하였는지
구체적인 경험을 바탕으로 서술하시오.

[초안 작성 규칙]

## 5단계 구조 (반드시 이 순서):
1. 부담 상황 (80~100자): 무슨 일이었고 왜 부담스러웠는지 (사용자 답변 그대로)
2. 솔직한 감정 + 판단 (60~80자): 처음엔 부담이었지만 왜 수락했는지
3. 구체적 노력 (120~150자): 어떤 행동을 했는지 (행동 동사 필수, 사용자 답변만)
4. 결과 (60~80자): 성과 (사용자가 말한 숫자만)
5. 직무 연결 + 포부 (80~100자): 승무원과의 연결

## 반드시 포함:
1. 부담/싫음을 인정하는 표현 1회 ("솔직히 부담이었다", "처음엔 꺼려졌다")
2. 판단 근거 ("~라고 생각했기에", "~를 고려하여")
3. 구체적 행동 동사 2~3개 (사용자가 말한 행동만)
4. 숫자는 사용자가 말한 것만
5. 안전 키워드 1개 (직무 연결 부분에서)
6. 540~580자

## 반드시 금지:
- "희생", "남들이 싫어해서 내가" -> 즉시 탈락 패턴
- "최선을 다했습니다" 류
- "저는~" 시작
- 부담을 인정하지 않고 바로 "해보기로 했다" -> 반드시 솔직한 감정 먼저
- 사용자가 말하지 않은 경험/결과 창작 금지

## 일부러 남겨둘 약점:
- 첫 문장: 평범하게 시작 (숫자 앵커링 없음)
- 마지막 문장: "~되겠습니다" 수준의 일반적 마무리
- 직무 연결이 약간 억지스러움 -> 첨삭에서 개선 여지

초안만 출력하세요. 설명이나 주석 없이."""


# ═══════════════════════════════════════════════
# 프롬프트 딕셔너리
# ═══════════════════════════════════════════════

DRAFT_PROMPTS = {
    1: DRAFT_Q1_PROMPT,
    2: DRAFT_Q2_PROMPT,
    3: DRAFT_Q3_PROMPT
}


def get_draft_prompt(question_num: int) -> str:
    """문항 번호에 해당하는 초안 생성 프롬프트 반환"""
    return DRAFT_PROMPTS.get(question_num, "")


def build_draft_prompt(question_num: int, answers: dict) -> str:
    """
    수집된 답변을 바탕으로 초안 생성 프롬프트 완성

    Args:
        question_num: 문항 번호 (1, 2, 3)
        answers: 인터뷰에서 수집된 답변 딕셔너리

    Returns:
        완성된 프롬프트 문자열
    """
    import json

    template = get_draft_prompt(question_num)
    if not template:
        return ""

    # 답변을 읽기 좋은 형태로 변환
    answers_text = json.dumps(answers, ensure_ascii=False, indent=2)

    return template.format(collected_answers=answers_text)


# ═══════════════════════════════════════════════
# 보정 프롬프트 (60점 조정용)
# ═══════════════════════════════════════════════

ADJUSTMENT_PROMPTS = {
    "reduce_score": """
[조정 지시]
현재 초안이 목표 점수(60점)보다 높습니다.
다음을 수정하세요:
- 숫자를 1개 줄이세요
- 첫 문장을 더 평범하게 시작하세요
- 행동 동사를 1개 줄이세요
- 마지막 문장을 더 일반적으로 바꾸세요

수정된 초안만 출력하세요.""",

    "increase_score": """
[조정 지시]
현재 초안이 목표 점수(60점)보다 낮습니다.
다음을 수정하세요:
- 안전 키워드를 1개 추가하세요
- 행동 동사를 1개 추가하세요 (사용자가 말한 행동 범위 내에서)
- 구조를 더 명확히 하세요

수정된 초안만 출력하세요."""
}


def get_adjustment_prompt(adjustment_type: str) -> str:
    """보정 프롬프트 반환"""
    return ADJUSTMENT_PROMPTS.get(adjustment_type, "")
